## 1.3. Качество данных
Оценим качество данных, на основе которых будут строится метрики.
В базе две схемы: production и analysis. Таблицы, необходимые для построения витрины находятся в схеме `production`.

### 1.3.1. Ограничения на данные в базе данных

| Таблица       | Поле     | Тип         |Ограничения            | Цель ограничения                                              |
| ------------- | ---------|-------------|-----------------------| ------------------------------------------------------------- |
| users         | id       | int4        | NOT NULL, PRIMARY KEY |Обеспечение уникальности и отсутствие пустых записей о клиентов |
| orderstatuses | id       | int4        | NOT NULL, PRIMARY KEY |Обеспечение уникальности и отсутствие пустых записей о статусах заказов |
| orderstatuses | key      | varchar(255)| NOT NULL              |Обеспечивает отсутствие пустых значений поля ключа статуса заказа|
| orders        | order_id | int4        | NOT NULL, PRIMARY KEY |Обеспечение уникальности и отсутствие пустых записей о заказах |
| orders        | users_id | int4        | NOT NULL              |Обеспечение отсутствие пустых записей о пользователях, совершивших заказы|
| orders        | status   | int4        | NOT NULL              |Обеспечение отсутствие пустых записей о статусе заказов|
| orders        | order_ts | timestamp   | NOT NULL              |Обеспечение отсутствие пустых записей о времени совершения заказов|

Имеющиеся ограничения обеспечивают коннктные типы данных, отсутствие пропущенных значений и дублей  ключевых полях.

### 1.3.2. Выполнение требований витрины

Таблица `users` содержит информацию о 1 000 клиентах

SELECT COUNT(1)  
FROM users;

Таблица с заказами `orders` содержит данные о 10 000 заказах 1 000 клиентов, из них  в статусе 'Closed' 4 991 у 988 клиентов

SELECT COUNT(1), COUNT(DISTINCT user_id)  
FROM orders;

SELECT count(1), COUNT(DISTINCT user_id)   
FROM orders  
WHERE status =  
    (SELECT id  
     FROM orderstatuses o  
     WHERE KEY = 'Closed');

**Проверка периода данных в базе**

SELECT min(order_ts), max(order_ts)  
FROM orders;  

Данные содержатся за период с 12.02.2022 по 14.03.2022 год

SELECT DATE_TRUNC('month', order_ts)::date, count(1)  
FROM orders  
GROUP BY 1  
ORDER BY 1;

| Месяц             | Кол-во заказов в месяц     | 
| ----------------- | ---------------------------|
| февраль 2022 года | 5705                       | 
| март 2022 года    | 4295                       | 

Данные содержатся только за 1 полный месяц, начиная с 12.02.2022 по 14.03.2022 год, а по заданию требуется период с начала 2022 года. 
Данных не хватает, но мы можем лишь спросить о наличии данных за январь у заказчика. Взять нам их неоткуда

**Проверка данных о сумме заказа**

SELECT min(payment), max(payment), avg(payment)  
FROM orders;

| Минимальная сумма заказа  | Максимальная сумма заказа | Средняя сумма заказа| 
| ------------------------- | --------------------------|---------------------|
| 60                        | 6360                      | 2289.93             |


Минимальная сумма заказа > 0, что подтверждает корректность данного параметра.

Данные качественны, но очень небольшой период данных.
